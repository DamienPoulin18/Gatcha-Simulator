<!DOCTYPE html>
<html lang="fr"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blox Fruits Gacha - Ultimate Edition</title>
    <style>
        :root {
            --bg-color: #0f0f12; --panel-color: #1e1e20;
            --common: #b1b1b1; --uncommon: #4a90e2; --rare: #9013fe;
            --legendary: #ff007a; --mythical: #ff0000; --accent: #ffd700;
            --amber: #ffbf00; --kitsune: #ff00ff;
        }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg-color); color: white; display: flex; flex-direction: column; align-items: center; margin: 0; overflow-x: hidden; }
 
        /* Gacha Rail */
        .gacha-header-container { width: 100%; background: #000; padding: 20px 0; border-bottom: 3px solid #333; display: flex; flex-direction: column; align-items: center; }
        .gacha-viewport { width: 95%; max-width: 1200px; height: 160px; background: #111; border: 4px solid var(--accent); border-radius: 15px; position: relative; overflow: hidden; display: flex; align-items: center; }
        .gacha-rail { display: flex; position: absolute; left: 0; transition: transform 4.5s cubic-bezier(0.1, 0, 0.1, 1); will-change: transform; }
        .gacha-item { min-width: 160px; height: 140px; margin: 0 10px; background: #222; display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: 12px; font-weight: bold; border-bottom: 4px solid #444; }
        .center-line { position: absolute; left: 50%; top: 0; bottom: 0; width: 6px; background: var(--accent); z-index: 10; transform: translateX(-50%); box-shadow: 0 0 15px gold; }
 
        /* Profil */
        .player-profile { background: #222; padding: 15px; border-radius: 10px; margin: 20px 0; border: 1px solid #444; width: 90%; max-width: 500px; }
        .level-bar { background: #444; height: 10px; border-radius: 5px; margin-top: 8px; overflow: hidden; }
        .level-fill { background: #2ecc71; height: 100%; width: 0%; transition: 0.4s; }
        .player-title { font-weight: bold; font-size: 0.85em; padding: 3px 8px; border-radius: 4px; margin-left: 10px; border: 1px solid; }
        .title-newbie { color: #aaa; border-color: #aaa; }
        .title-expert { color: gold; border-color: gold; box-shadow: 0 0 5px gold; }
        .title-kitsune-king { color: var(--kitsune); border: 2px solid var(--kitsune); box-shadow: 0 0 15px var(--kitsune); animation: k-glow 1.5s infinite alternate; }
        @keyframes k-glow { from { filter: brightness(1); } to { filter: brightness(1.5) hue-rotate(45deg); } }
 
        /* Inventaire & Cartes */
        .inventory-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; height: 400px; overflow-y: auto; background: #000; padding: 15px; border-radius: 8px; border: 1px solid #333; }
        .fruit-card { padding: 10px; border-radius: 8px; text-align: center; cursor: pointer; background: #252527; border: 2px solid transparent; transition: 0.2s; position: relative; }
        .fruit-card.fav { border-color: gold; box-shadow: inset 0 0 10px gold; }
        .badge-skin { position: absolute; top: 5px; right: 5px; background: #00f2ff; color: #000; font-size: 8px; padding: 2px 4px; border-radius: 3px; font-weight: bold; }
        .rarity-Amber { color: var(--amber); border-color: var(--amber); }
        .rarity-Mythical { color: var(--mythical); border-color: var(--mythical); }
 
        /* Trade Window */
        .trade-window { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #111; border: 4px solid #444; width: 90%; max-width: 850px; padding: 25px; z-index: 100; border-radius: 15px; box-shadow: 0 0 100px #000; }
        #fruit-selector-modal { display: none; position: absolute; top: 5%; left: 5%; width: 90%; height: 90%; background: #2c2c2e; border: 3px solid var(--accent); z-index: 200; border-radius: 15px; padding: 20px; }
        .shake { animation: shake 0.2s infinite; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-4px); } 75% { transform: translateX(4px); } }
    
    </style>
</head>
<!-- Fen√™tre de s√©lection des titres -->
<!-- PANNEAU DASH CENTER -->


<body>
 <div id="games-panel" style="position: fixed; top: 0; left: -300px; width: 280px; height: 100%; background: #1a1a1a; border-right: 3px solid #4A752C; transition: 0.5s; z-index: 5001; padding: 20px; font-family: 'Segoe UI', sans-serif;">
    <h2 style="color: #aad751; text-align: center; text-shadow: 0 0 10px #4A752C;">GAME CENTER</h2>
    
    <div style="display: flex; flex-direction: column; gap: 15px; margin-top: 20px;">
        <!-- BOUTON GEOMETRY DASH -->
        <div onclick="startGeoDash()" style="background: #000; border: 2px solid #00fbff; border-radius: 10px; padding: 15px; cursor: pointer; text-align: center;">
            <div style="color: #00fbff; font-weight: bold;">GEOMETRY DASH</div>
            <small style="color: #888;">Gain: 750 Beli / %</small>
        </div>

        <!-- BOUTON SNAKE GOOGLE -->
        <div onclick="startSnakeGame()" style="background: #4A752C; border: 2px solid #aad751; border-radius: 10px; padding: 15px; cursor: pointer; text-align: center;">
            <div style="color: #fff; font-weight: bold;">SNAKE REALISTE</div>
            <small style="color: #aad751;">Gain: 500 Beli / Pomme</small>
        </div>
    </div>
    <div id="snake-modal" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #4A752C; border: 8px solid #578A34; z-index: 6000; border-radius: 15px; text-align: center; box-shadow: 0 20px 50px rgba(0,0,0,0.5); font-family: sans-serif;">
    <div style="padding: 10px; display: flex; justify-content: space-around; font-size: 20px; font-weight: bold; color: white;">
        <span>üçé <span id="snake-score">0</span></span>
        <button onclick="stopSnake()" style="background: #E74C3C; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer;">QUITTER</button>
    </div>
    <canvas id="snakeCanvas" width="400" height="400" style="background-color: #aad751; background-image: conic-gradient(#a2d149 0.25turn, #aad751 0.25turn 0.5turn, #a2d149 0.5turn 0.75turn, #aad751 0.75turn); background-size: 40px 40px;"></canvas>
</div>

    <button onclick="document.getElementById('games-panel').style.left = '-300px'" style="width: 100%; padding: 10px; background: #333; color: white; border: none; border-radius: 5px; margin-top: 30px; cursor: pointer;">RETOUR</button>
</div>

    <button onclick="document.getElementById('games-panel').style.left = '-300px'" style="width: 100%; padding: 12px; background: #333; color: white; border: none; border-radius: 8px; cursor: pointer; margin-top: 20px; font-weight: bold;">RETOUR</button>
</div>
<div id="dash-modal" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #000; border: 4px solid #0088ff; z-index: 5000; border-radius: 10px; overflow: hidden; box-shadow: 0 0 60px rgba(0, 136, 255, 0.4);">
    <div style="position: absolute; top: 20px; width: 100%; text-align: center; color: #00fbff; font-size: 28px; text-shadow: 2px 2px #000; z-index: 10; font-family: 'Arial Black', sans-serif;">
        <span id="pct">0</span>%
    </div>
    <canvas id="gd" width="800" height="450"></canvas>
    <button onclick="stopGeoDash()" style="position: absolute; top: 15px; right: 15px; padding: 10px 15px; background: rgba(255,0,0,0.6); color: white; border: 2px solid #fff; border-radius: 5px; cursor: pointer; font-weight: bold; z-index: 20;">QUITTER</button>
</div>





      <style>
        /* Section Sp√©ciale Titres RGB */
        .title-dough-king {
            border: 2px solid;
            animation: dough-rgb 3s linear infinite;
            font-weight: bold;
            padding: 3px 8px;
            border-radius: 4px;
            text-shadow: 0 0 5px rgba(255,255,255,0.5);
            display: inline-block;
        }

        @keyframes dough-rgb {
            0% { color: #ff0000; border-color: #ff0000; box-shadow: 0 0 10px #ff0000; }
            20% { color: #ffff00; border-color: #ffff00; box-shadow: 0 0 10px #ffff00; }
            40% { color: #00ff00; border-color: #00ff00; box-shadow: 0 0 10px #00ff00; }
            60% { color: #00ffff; border-color: #00ffff; box-shadow: 0 0 10px #00ffff; }
            80% { color: #0000ff; border-color: #0000ff; box-shadow: 0 0 10px #0000ff; }
            100% { color: #ff00ff; border-color: #ff00ff; box-shadow: 0 0 10px #ff00ff; }
        }
    </style>

  <div id="title-menu" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgb(26, 26, 28); border: 3px solid var(--accent); padding: 20px; border-radius: 15px; z-index: 1001; width: 300px; box-shadow: rgb(0, 0, 0) 0px 0px 100px;">
    <h3 style="text-align: center; color: var(--accent); margin-top: 0; font-family: sans-serif;">S√âLECTION DE TITRE</h3>
    <div id="title-list" style="display: flex; flex-direction: column; gap: 10px; max-height: 300px; overflow-y: auto; padding: 5px;"><button class="player-title title-newbie" style="padding: 10px; cursor: pointer; text-align: center; background: rgb(34, 34, 34); border: 1px solid rgb(68, 68, 68); margin-bottom: 5px;">Recrue</button><button class="player-title title-kitsune-king" style="padding: 10px; cursor: pointer; text-align: center; background: rgb(34, 34, 34); border: 1px solid rgb(68, 68, 68); margin-bottom: 5px;">King of Kitsune</button><button class="player-title title-expert" style="padding: 10px; cursor: pointer; text-align: center; background: rgb(34, 34, 34); border: 1px solid rgb(68, 68, 68); margin-bottom: 5px;">Ma√Ætre des √âp√©es</button></div>
    <button onclick="document.getElementById('title-menu').style.display='none'" style="width: 100%; margin-top: 15px; padding: 10px; background: #444; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;">FERMER</button>
</div>


<div id="admin-panel" style="position: fixed; top: 0; left: -300px; width: 280px; height: 100%; background: #111; border-right: 4px solid orange; transition: 0.4s; z-index: 1000; padding: 20px; overflow-y: auto; box-shadow: 5px 0 15px rgba(0,0,0,0.5);">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2 style="color: orange; margin: 0; font-size: 1.2em;">üîß ADMIN PANEL</h2>
        <button onclick="document.getElementById('admin-panel').style.left = '-300px'" style="background: #ff4757; color: white; border: none; padding: 5px 10px; cursor: pointer; border-radius: 5px; font-weight: bold;">X</button>
    </div>
    
    <button onclick="money += 1000000000; updateUI();" style="width: 100%; padding: 10px; background: #2ecc71; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; margin-bottom: 15px;">üí∞ +1,000,000,000$</button>
    
    <div id="admin-fruit-list" style="display: flex; flex-direction: column; gap: 8px;">
        <!-- Liste des fruits g√©n√©r√©e ici -->
    </div>
</div>


 
<div class="gacha-header-container">
    <div class="gacha-viewport">
        <div class="center-line"></div>
        <div id="gacha-rail" class="gacha-rail" style="transition: transform 4.5s cubic-bezier(0.1, 0, 0.1, 1); transform: translateX(-12086px);"><div class="gacha-item rarity-Uncommon"><img src="https://api.dicebear.com" width="60"><div>Ice</div></div><div class="gacha-item rarity-Legendary"><img src="https://api.dicebear.com" width="60"><div>Buddha</div></div><div class="gacha-item rarity-Common"><img src="https://api.dicebear.com" width="60"><div>Bomb</div></div><div class="gacha-item rarity-Legendary"><img src="https://api.dicebear.com" width="60"><div>Rumble</div></div><div class="gacha-item rarity-Mythical"><img src="https://api.dicebear.com" width="60"><div>Leopard</div></div><div class="gacha-item rarity-Legendary"><img src="https://api.dicebear.com" width="60"><div>Gravity</div></div><div class="gacha-item rarity-Mythical"><img src="https://api.dicebear.com" width="60"><div>Venom</div></div><div class="gacha-item rarity-Legendary"><img src="https://api.dicebear.com" width="60"><div>Rumble</div></div><div class="gacha-item rarity-Mythical"><img src="https://api.dicebear.com" width="60"><div>Venom</div></div><div class="gacha-item rarity-Common"><img src="https://api.dicebear.com" width="60"><div>Spike</div></div><div class="gacha-item rarity-Mythical"><img src="https://api.dicebear.com" width="60"><div>T-Rex</div></div><div class="gacha-item rarity-Common"><img src="https://api.dicebear.com" width="60"><div>Bomb</div></div><div class="gacha-item rarity-Legendary"><img src="https://api.dicebear.com" width="60"><div>Pain</div></div><div class="gacha-item rarity-Uncommon"><img src="https://api.dicebear.com" width="60"><div>Flame</div></div><div class="gacha-item rarity-Mythical"><img src="https://api.dicebear.com" width="60"><div>T-Rex</div></div><div class="gacha-item rarity-Common"><img src="https://api.dicebear.com" width="60"><div>Smoke</div></div><div class="gacha-item rarity-Mythical"><img src="https://api.dicebear.com" width="60"><div>Control</div></div><div class="gacha-item rarity-Legendary"><img src="https://api.dicebear.com" width="60"><div>Blizzard</div></div><div class="gacha-item rarity-Common"><img src="https://api.dicebear.com" width="60"><div>Rocket</div></div><div class="gacha-item rarity-Common"><img src="https://api.dicebear.com" width="60"><div>Rocket</div></div><div class="gacha-item rarity-Mythical"><img src="https://api.dicebear.com" width="60"><div>T-Rex</div></div><div class="gacha-item rarity-Mythical"><img src="https://api.dicebear.com" width="60"><div>Mammoth</div></div><div class="gacha-item rarity-Rare"><img src="https://api.dicebear.com" width="60"><div>Light</div></div><div class="gacha-item rarity-Legendary"><img src="https://api.dicebear.com" width="60"><div>Spider</div></div><div class="gacha-item rarity-Mythical"><img src="https://api.dicebear.com" width="60"><div>Shadow</div></div><div class="gacha-item rarity-Rare"><img src="https://api.dicebear.com" width="60"><div>Ghost</div></div><div class="gacha-item rarity-Uncommon"><img src="https://api.dicebear.com" width="60"><div>Falcon</div></div><div class="gacha-item rarity-Mythical"><img src="https://api.dicebear.com" width="60"><div>Dragon</div></div><div class="gacha-item rarity-Rare"><img src="https://api.dicebear.com" width="60"><div>Rubber</div></div><div class="gacha-item rarity-Legendary"><img src="https://api.dicebear.com" width="60"><div>Love</div></div><div class="gacha-item rarity-Legendary"><img src="https://api.dicebear.com" width="60"><div>Blizzard</div></div><div class="gacha-item rarity-Mythical"><img src="https://api.dicebear.com" width="60"><div>Gas</div></div><div class="gacha-item rarity-Legendary"><img src="https://api.dicebear.com" width="60"><div>Rumble</div></div><div class="gacha-item rarity-Common"><img src="https://api.dicebear.com" width="60"><div>Spring</div></div><div class="gacha-item rarity-Legendary"><img src="https://api.dicebear.com" width="60"><div>Gravity</div></div><div class="gacha-item rarity-Common"><img src="https://api.dicebear.com" width="60"><div>Spring</div></div><div class="gacha-item rarity-Legendary"><img src="https://api.dicebear.com" width="60"><div>Pain</div></div><div class="gacha-item rarity-Rare"><img src="https://api.dicebear.com" width="60"><div>Quake</div></div><div class="gacha-item rarity-Mythical"><img src="https://api.dicebear.com" width="60"><div>Dough</div></div><div class="gacha-item rarity-Mythical"><img src="https://api.dicebear.com" width="60"><div>Control</div></div><div class="gacha-item rarity-Uncommon"><img src="https://api.dicebear.com" width="60"><div>Falcon</div></div><div class="gacha-item rarity-Mythical"><img src="https://api.dicebear.com" width="60"><div>Kitsune</div></div><div class="gacha-item rarity-Rare"><img src="https://api.dicebear.com" width="60"><div>Barrier</div></div><div class="gacha-item rarity-Mythical"><img src="https://api.dicebear.com" width="60"><div>Gas</div></div><div class="gacha-item rarity-Common"><img src="https://api.dicebear.com" width="60"><div>Rocket</div></div><div class="gacha-item rarity-Common"><img src="https://api.dicebear.com" width="60"><div>Spike</div></div><div class="gacha-item rarity-Common"><img src="https://api.dicebear.com" width="60"><div>Spring</div></div><div class="gacha-item rarity-Rare"><img src="https://api.dicebear.com" width="60"><div>Quake</div></div><div class="gacha-item rarity-Uncommon"><img src="https://api.dicebear.com" width="60"><div>Ice</div></div><div class="gacha-item rarity-Rare"><img src="https://api.dicebear.com" width="60"><div>Quake</div></div><div class="gacha-item rarity-Mythical"><img src="https://api.dicebear.com" width="60"><div>Kitsune</div></div><div class="gacha-item rarity-Uncommon"><img src="https://api.dicebear.com" width="60"><div>Sand</div></div><div class="gacha-item rarity-Uncommon"><img src="https://api.dicebear.com" width="60"><div>Ice</div></div><div class="gacha-item rarity-Mythical"><img src="https://api.dicebear.com" width="60"><div>Venom</div></div><div class="gacha-item rarity-Rare"><img src="https://api.dicebear.com" width="60"><div>Light</div></div><div class="gacha-item rarity-Common"><img src="https://api.dicebear.com" width="60"><div>Spring</div></div><div class="gacha-item rarity-Common"><img src="https://api.dicebear.com" width="60"><div>Spike</div></div><div class="gacha-item rarity-Uncommon"><img src="https://api.dicebear.com" width="60"><div>Ice</div></div><div class="gacha-item rarity-Legendary"><img src="https://api.dicebear.com" width="60"><div>Phoenix</div></div><div class="gacha-item rarity-Mythical"><img src="https://api.dicebear.com" width="60"><div>Gas</div></div><div class="gacha-item rarity-Legendary"><img src="https://api.dicebear.com" width="60"><div>Rumble</div></div><div class="gacha-item rarity-Legendary"><img src="https://api.dicebear.com" width="60"><div>Portal</div></div><div class="gacha-item rarity-Legendary"><img src="https://api.dicebear.com" width="60"><div>Love</div></div><div class="gacha-item rarity-Rare"><img src="https://api.dicebear.com" width="60"><div>Barrier</div></div><div class="gacha-item rarity-Legendary"><img src="https://api.dicebear.com" width="60"><div>Phoenix</div></div><div class="gacha-item rarity-Legendary"><img src="https://api.dicebear.com" width="60"><div>Love</div></div><div class="gacha-item rarity-Common"><img src="https://api.dicebear.com" width="60"><div>Blade</div></div><div class="gacha-item rarity-Mythical"><img src="https://api.dicebear.com" width="60"><div>Control</div></div><div class="gacha-item rarity-Mythical"><img src="https://api.dicebear.com" width="60"><div>Shadow</div></div><div class="gacha-item rarity-Common"><img src="https://api.dicebear.com" width="60"><div>Spring</div></div><div class="gacha-item rarity-Legendary"><img src="https://api.dicebear.com" width="60"><div>Spring</div></div><div class="gacha-item rarity-Common"><img src="https://api.dicebear.com" width="60"><div>Rocket</div></div><div class="gacha-item rarity-Mythical"><img src="https://api.dicebear.com" width="60"><div>Gas</div></div><div class="gacha-item rarity-Legendary"><img src="https://api.dicebear.com" width="60"><div>Pain</div></div><div class="gacha-item rarity-Legendary"><img src="https://api.dicebear.com" width="60"><div>Gravity</div></div><div class="gacha-item rarity-Common"><img src="https://api.dicebear.com" width="60"><div>Spring</div></div><div class="gacha-item rarity-Legendary"><img src="https://api.dicebear.com" width="60"><div>Gravity</div></div><div class="gacha-item rarity-Rare"><img src="https://api.dicebear.com" width="60"><div>Magma</div></div><div class="gacha-item rarity-Rare"><img src="https://api.dicebear.com" width="60"><div>Ghost</div></div><div class="gacha-item rarity-Mythical"><img src="https://api.dicebear.com" width="60"><div>T-Rex</div></div><div class="gacha-item rarity-Common"><img src="https://api.dicebear.com" width="60"><div>Spin</div></div><div class="gacha-item rarity-Legendary"><img src="https://api.dicebear.com" width="60"><div>Sound</div></div><div class="gacha-item rarity-Legendary"><img src="https://api.dicebear.com" width="60"><div>Pain</div></div><div class="gacha-item rarity-Common"><img src="https://api.dicebear.com" width="60"><div>Spike</div></div><div class="gacha-item rarity-Mythical"><img src="https://api.dicebear.com" width="60"><div>Mammoth</div></div></div>
    </div>
    <div style="display: flex; gap: 30px; align-items: center; margin-top: 15px;">
        <h2 style="color: #2ecc71; margin:0;">Beli: <span id="money">2‚ÄØ509‚ÄØ871‚ÄØ750</span>$</h2>
        <button class="btn-roll" id="roll-btn" onclick="startRoll()" style="padding:12px 40px; background:var(--accent); font-weight:bold; border:none; border-radius:5px; cursor:pointer;">SPIN GACHA</button>
    </div>
</div>
 
<div class="player-profile">
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <div>
            <input type="text" id="player-name" style="background:none; border:none; color:white; font-weight:bold; border-bottom:1px solid #555; width:120px;" value="Joueur" onchange="save()">
            <span id="display-title" class="player-title title-dough-king">Dough King</span>
        </div>
        <b>Niveau <span id="player-lvl">4</span></b>
    </div>
    <div class="level-bar"><div id="lvl-fill" class="level-fill" style="width: 75%;"></div></div>
    <small style="color:#888;">XP: <span id="player-xp">300</span> / <span id="xp-next">400</span></small>
</div>
 
<div style="margin-bottom: 20px;">
    <input type="text" id="dlc-input" style="padding:8px; background:#111; color:orange; border:1px solid #444; border-radius:4px;" placeholder="CODE SECRET">
    <button onclick="activateDLC()" style="padding:8px 15px; background:orange; border:none; cursor:pointer; font-weight:bold;">ACTIVER</button>
</div>
 
<div style="width: 95%; max-width: 1100px; background: var(--panel-color); padding: 20px; border-radius: 12px;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
        <div style="display:flex; gap:10px;">
 
            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px; margin-bottom: 15px;">
    <h2 style="margin:0;">Inventaire</h2>
    <div style="display:flex; gap:10px; flex-wrap: wrap;">
        <button onclick="sellAllNonFav()" style="background:#f39c12; color:white; border:none; padding:10px 15px; cursor:pointer; border-radius:5px; font-weight:bold; font-size: 13px;">üí∞ VENDRE TOUT (Sauf ‚≠ê)</button>
        <button onclick="openTrade()" style="background:#007bff; color:white; border:none; padding:10px 15px; cursor:pointer; border-radius:5px; font-weight:bold; font-size: 13px;">ü§ù TRADE NPC</button>
        <button onclick="importCode()" style="background:#2ecc71; color:white; border:none; padding:10px 15px; cursor:pointer; border-radius:5px; font-weight:bold; font-size: 13px;">üì• IMPORT CODE</button>
    <!-- √Ä ins√©rer dans ta div player-profile actuelle -->
<button onclick="openTitleMenu()" style="margin-top: 10px; width: 100%; padding: 6px; font-size: 0.75em; background: #2c2c2e; color: #ffd700; border: 1px solid #ffd700; border-radius: 5px; cursor: pointer; font-weight: bold; transition: 0.3s;">
    üè∑Ô∏è CHANGER DE TITRE
</button>

    
    </div>
</div>
 
        </div>
    </div>
    <div id="inventory" class="inventory-grid">
            <div class="fruit-card rarity-Mythical fav" onclick="selectItem(0)">
                
                <img src="https://api.dicebear.com"><br><b>Gas</b>
            </div>
            <div class="fruit-card rarity-Mythical fav" onclick="selectItem(1)">
                <span class="badge-skin">SKIN</span>
                <img src="https://api.dicebear.com"><br><b>Werewolf</b>
            </div>
            <div class="fruit-card rarity-Common " onclick="selectItem(2)">
                
                <img src="https://api.dicebear.com"><br><b>Rocket</b>
            </div>
            <div class="fruit-card rarity-Amber fav" onclick="selectItem(3)">
                
                <img src="https://api.dicebear.com"><br><b>Dragon Amber</b>
            </div>
            <div class="fruit-card rarity-Amber fav" onclick="selectItem(4)">
                
                <img src="https://api.dicebear.com"><br><b>Dark Blade</b>
            </div>
            <div class="fruit-card rarity-Common " onclick="selectItem(5)">
                
                <img src="https://api.dicebear.com"><br><b>Spring</b>
            </div></div>
    <div id="actions" style="margin-top: 15px; background: rgb(61, 61, 64); padding: 15px; border-radius: 10px; display: none; justify-content: space-between; align-items: center;">
        <span id="sel-name" style="font-weight:bold; font-size:18px;">Dark Blade</span>
        <div>
            <button onclick="toggleFav()" style="background:none; border:none; font-size:24px; cursor:pointer;">‚≠ê</button>
            <button onclick="sellFruit()" style="background:#dc3545; color:white; border:none; padding:10px 20px; border-radius:5px; font-weight:bold; cursor:pointer;">Vendre (50%)</button>
        </div>
    </div>
</div>
 
<div id="trade-ui" class="trade-window" style="display: none;">
    <div style="display:flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
        <h2 id="trade-title" style="margin:0;">TRADE NPC</h2>
        <h2 id="cooldown-timer" style="color: rgb(255, 71, 87); display: none; background: rgb(0, 0, 0); padding: 8px; border-radius: 8px;">9</h2>
    </div>
    <div style="display: flex; gap: 15px;">
        <div style="flex:1;">
            <div id="p-slots" style="display:grid; grid-template-columns:1fr 1fr; gap:8px; background:#000; height:200px; padding:10px; border-radius:8px;">
                <div style="border:2px dashed #444; display:flex; align-items:center; justify-content:center; cursor:pointer;" onclick="if(!false) openSelector()">+</div>
                <div style="border:2px dashed #444; display:flex; align-items:center; justify-content:center; cursor:pointer;" onclick="if(!false) openSelector()">+</div>
                <div style="border:2px dashed #444; display:flex; align-items:center; justify-content:center; cursor:pointer;" onclick="if(!false) openSelector()">+</div>
                <div style="border:2px dashed #444; display:flex; align-items:center; justify-content:center; cursor:pointer;" onclick="if(!false) openSelector()">+</div></div>
            <div style="text-align:center; color:gold; font-weight:bold; margin-top:5px;">Valeur: <span id="p-val">0</span></div>
            <button id="btn-gen-code" onclick="exportCode()" style="width: 100%; margin-top: 10px; background: rgb(74, 144, 226); color: white; border: none; padding: 10px; cursor: pointer; font-weight: bold; border-radius: 5px; display: block;">G√âN√âRER CODE</button>
        </div>
        <div style="flex:1;">
            <div id="npc-slots" style="display:grid; grid-template-columns:1fr 1fr; gap:8px; background:#000; height:200px; padding:10px; border-radius:8px;"><div style="border:2px dashed #333;"></div><div style="border:2px dashed #333;"></div><div style="border:2px dashed #333;"></div><div style="border:2px dashed #333;"></div></div>
            <div style="text-align:center; color:gold; font-weight:bold; margin-top:5px;">Valeur: <span id="n-val">0</span></div>
        </div>
    </div>
    <div id="diff-msg" style="text-align: center; margin: 15px; font-weight: bold; color: rgb(255, 71, 87);" class="">VALEUR IN√âGALE ‚ö†</div>
    <div style="display:flex; gap:10px;">
        <button id="accept-btn" onclick="startTradeTimer()" style="flex: 2 1 0%; padding: 15px; background: gold; font-weight: bold; border: none; border-radius: 8px; cursor: not-allowed; font-size: 18px; opacity: 0.5;" disabled="">CONFIRMER</button>
        <button onclick="closeTrade()" style="flex:1; background:#444; color:white; border:none; border-radius:8px; cursor:pointer;">ANNULER</button>
    </div>
    <div id="fruit-selector-modal" style="display: none;">
        <h3 style="text-align:center;">Choisir un fruit</h3>
        <div id="selector-grid" style="display:grid; grid-template-columns:repeat(auto-fill, minmax(120px, 1fr)); gap:10px; overflow-y:auto; height:80%;"><div class="fruit-card rarity-Legendary" onclick="pTradeIndices.push(3); if(document.getElementById('trade-title').innerText==='TRADE NPC')npcOffer(); refreshTrade(); closeSelector();"><img src="https://api.dicebear.com">Sunken Chest</div><div class="fruit-card rarity-Common" onclick="pTradeIndices.push(4); if(document.getElementById('trade-title').innerText==='TRADE NPC')npcOffer(); refreshTrade(); closeSelector();"><img src="https://api.dicebear.com">Spring</div><div class="fruit-card rarity-Common" onclick="pTradeIndices.push(6); if(document.getElementById('trade-title').innerText==='TRADE NPC')npcOffer(); refreshTrade(); closeSelector();"><img src="https://api.dicebear.com">Spin</div><div class="fruit-card rarity-Uncommon" onclick="pTradeIndices.push(7); if(document.getElementById('trade-title').innerText==='TRADE NPC')npcOffer(); refreshTrade(); closeSelector();"><img src="https://api.dicebear.com">Flame</div><div class="fruit-card rarity-Common" onclick="pTradeIndices.push(8); if(document.getElementById('trade-title').innerText==='TRADE NPC')npcOffer(); refreshTrade(); closeSelector();"><img src="https://api.dicebear.com">Spin</div><div class="fruit-card rarity-Common" onclick="pTradeIndices.push(9); if(document.getElementById('trade-title').innerText==='TRADE NPC')npcOffer(); refreshTrade(); closeSelector();"><img src="https://api.dicebear.com">Spin</div><div class="fruit-card rarity-Rare" onclick="pTradeIndices.push(10); if(document.getElementById('trade-title').innerText==='TRADE NPC')npcOffer(); refreshTrade(); closeSelector();"><img src="https://api.dicebear.com">Magma</div><div class="fruit-card rarity-Common" onclick="pTradeIndices.push(11); if(document.getElementById('trade-title').innerText==='TRADE NPC')npcOffer(); refreshTrade(); closeSelector();"><img src="https://api.dicebear.com">Spring</div><div class="fruit-card rarity-Legendary" onclick="pTradeIndices.push(12); if(document.getElementById('trade-title').innerText==='TRADE NPC')npcOffer(); refreshTrade(); closeSelector();"><img src="https://api.dicebear.com">Spider</div></div>
        <button onclick="closeSelector()" style="width:100%; background:#ff4757; color:white; border:none; padding:12px; margin-top:10px; cursor:pointer; border-radius:8px; font-weight:bold;">RETOUR</button>
    </div>
</div>
<script>
    let money = 1000000; let inventory = []; let playerXP = 0; let playerLvl = 1; 
let hasKitsuneTitle = false; let selectedIdx = null; let tradeInterval = null;
let hasDoughTitle = false;
let pTradeIndices = []; let npcTradeItems = [];
let isLocked = false; // Par d√©faut, rien n'est bloqu√©
isLocked = false; 
document.getElementById('cooldown-timer').style.display = 'none';
 let usedTradeCodes = JSON.parse(localStorage.getItem('usedCodes')) || [];
 
 
const fruits = [
    // COMMON
    { name: "Rocket", rarity: "Common", weight: 45, price: 5000, val: 5000, img: "https://api.dicebear.com" },
    { name: "Spin", rarity: "Common", weight: 40, price: 7500, val: 7500, img: "https://api.dicebear.com" },
    { name: "Blade", rarity: "Common", weight: 35, price: 30000, val: 30000, img: "https://api.dicebear.com" },
    { name: "Spring", rarity: "Common", weight: 30, price: 60000, val: 60000, img: "https://api.dicebear.com" },
    { name: "Bomb", rarity: "Common", weight: 28, price: 80000, val: 80000, img: "https://api.dicebear.com" },
    { name: "Smoke", rarity: "Common", weight: 25, price: 100000, val: 100000, img: "https://api.dicebear.com" },
    { name: "Spike", rarity: "Common", weight: 22, price: 180000, val: 180000, img: "https://api.dicebear.com" },
 
    // UNCOMMON
    { name: "Flame", rarity: "Uncommon", weight: 20, price: 250000, val: 250000, img: "https://api.dicebear.com" },
    { name: "Falcon", rarity: "Uncommon", weight: 19, price: 300000, val: 300000, img: "https://api.dicebear.com" },
    { name: "Ice", rarity: "Uncommon", weight: 18, price: 350000, val: 350000, img: "https://api.dicebear.com" },
    { name: "Sand", rarity: "Uncommon", weight: 17, price: 420000, val: 420000, img: "https://api.dicebear.com" },
    { name: "Dark", rarity: "Uncommon", weight: 16, price: 500000, val: 500000, img: "https://api.dicebear.com" },
    { name: "Diamond", rarity: "Uncommon", weight: 15, price: 600000, val: 600000, img: "https://api.dicebear.com" },
 
    // RARE
    { name: "Light", rarity: "Rare", weight: 12, price: 650000, val: 1100000, img: "https://api.dicebear.com" },
    { name: "Rubber", rarity: "Rare", weight: 11, price: 750000, val: 1200000, img: "https://api.dicebear.com" },
    { name: "Barrier", rarity: "Rare", weight: 10, price: 800000, val: 1250000, img: "https://api.dicebear.com" },
    { name: "Ghost", rarity: "Rare", weight: 9, price: 940000, val: 1275000, img: "https://api.dicebear.com" },
    { name: "Magma", rarity: "Rare", weight: 8, price: 850000, val: 1300000, img: "https://api.dicebear.com" },
    { name: "Quake", rarity: "Rare", weight: 7, price: 1000000, val: 1500000, img: "https://api.dicebear.com" },
 
    // LEGENDARY
    { name: "Buddha", rarity: "Legendary", weight: 5, price: 1200000, val: 2800000, img: "https://api.dicebear.com" },
    { name: "Love", rarity: "Legendary", weight: 4.5, price: 1300000, val: 2000000, img: "https://api.dicebear.com" },
    { name: "Spider", rarity: "Legendary", weight: 4, price: 1500000, val: 2200000, img: "https://api.dicebear.com" },
    { name: "Sound", rarity: "Legendary", weight: 3.8, price: 1700000, val: 2300000, img: "https://api.dicebear.com" },
    { name: "Phoenix", rarity: "Legendary", weight: 3.5, price: 1800000, val: 2500000, img: "https://api.dicebear.com" },
    { name: "Portal", rarity: "Legendary", weight: 3, price: 1900000, val: 2400000, img: "https://api.dicebear.com" },
    { name: "Rumble", rarity: "Legendary", weight: 2.8, price: 2100000, val: 2600000, img: "https://api.dicebear.com" },
    { name: "Pain", rarity: "Legendary", weight: 2.5, price: 2300000, val: 2100000, img: "https://api.dicebear.com" },
    { name: "Blizzard", rarity: "Legendary", weight: 2.2, price: 2400000, val: 3200000, img: "https://api.dicebear.com" },
    { name: "Gravity", rarity: "Legendary", weight: 2, price: 2500000, val: 2000000, img: "https://api.dicebear.com" },
 
    // MYTHICAL
    { name: "Mammoth", rarity: "Mythical", weight: 1.5, price: 2700000, val: 4000000, img: "https://api.dicebear.com" },
    { name: "T-Rex", rarity: "Mythical", weight: 1.3, price: 2700000, val: 4500000, img: "https://api.dicebear.com" },
    { name: "Dough", rarity: "Mythical", weight: 1, price: 2800000, val: 5000000, img: "https://api.dicebear.com" },
    { name: "Shadow", rarity: "Mythical", weight: 0.9, price: 2900000, val: 3500000, img: "https://api.dicebear.com" },
    { name: "Venom", rarity: "Mythical", weight: 0.8, price: 3000000, val: 4800000, img: "https://api.dicebear.com" },
    { name: "Control", rarity: "Mythical", weight: 0.7, price: 3200000, val: 4000000, img: "https://api.dicebear.com" },
    { name: "Gas", rarity: "Mythical", weight: 0.6, price: 3300000, val: 5200000, img: "https://api.dicebear.com" },
    { name: "Spirit", rarity: "Mythical", weight: 0.5, price: 3400000, val: 5500000, img: "https://api.dicebear.com" },
    { name: "Leopard", rarity: "Mythical", weight: 0.4, price: 5000000, val: 7500000, img: "https://api.dicebear.com" },
    { name: "Kitsune", rarity: "Mythical", weight: 0.3, price: 8000000, val: 12000000, img: "https://api.dicebear.com" },
    { name: "Dragon", rarity: "Mythical", weight: 0.2, price: 10000000, val: 20000000, img: "https://api.dicebear.com" },
  { name: "Dragon Amber", rarity: "Amber", weight: 0, price: 200000000, val: 150000000, img: "https://api.dicebear.com" }
];
 
    const allSkins = [
        { name: "Krimson Kitsune", rarity: "Amber", val: 85000000, isSkin: true, img: "https://api.dicebear.com" },
        { name: "Galaxy Kitsune", rarity: "Amber", val: 90000000, isSkin: true, img: "https://api.dicebear.com" },
        { name: "Werewolf", rarity: "Mythical", val: 45000000, isSkin: true, img: "https://api.dicebear.com" }
    ];
 
    const sunkenChest = { name: "Sunken Chest", rarity: "Legendary", isChest: true, val: 40000000, img: "https://api.dicebear.com" };
 
    function save() {
    const data = {
        money: money,
        inventory: inventory,
        playerXP: playerXP,
        playerLvl: playerLvl,
        hasKitsuneTitle: hasKitsuneTitle,
        hasDoughTitle: hasDoughTitle, // Ajout√©
        currentTitleName: document.getElementById('display-title').innerText, // Ajout√©
        currentTitleClass: document.getElementById('display-title').className, // Ajout√©
        playerName: document.getElementById('player-name').value
    };
    localStorage.setItem('bloxUltimate_FINAL', JSON.stringify(data));
}

    function load() {
    const s = localStorage.getItem('bloxUltimate_FINAL');
    if (s) {
        const d = JSON.parse(s);
        money = d.money;
        inventory = d.inventory;
        playerXP = d.playerXP || 0;
        playerLvl = d.playerLvl || 1;
        hasKitsuneTitle = d.hasKitsuneTitle || false;
        hasDoughTitle = d.hasDoughTitle || false; // Chargement
        
        // Restaurer le titre visuel
        const ts = document.getElementById('display-title');
        if (d.currentTitleName) {
            ts.innerText = d.currentTitleName;
            ts.className = d.currentTitleClass;
        }
        
        document.getElementById('player-name').value = d.playerName || "Joueur";
    }
}

 
    function updateUI() {
        document.getElementById('money').innerText = money.toLocaleString();
        document.getElementById('inventory').innerHTML = inventory.map((f, i) => `
            <div class="fruit-card rarity-${f.rarity} ${f.isFav?'fav':''}" onclick="selectItem(${i})">
                ${f.isSkin ? '<span class="badge-skin">SKIN</span>' : ''}
                <img src="${f.img}"><br><b>${f.name}</b>
            </div>`).join('');
        updateProfileUI(); save();
    }
 
    function updateProfileUI() {
        document.getElementById('player-lvl').innerText = playerLvl;
        document.getElementById('player-xp').innerText = playerXP;
        document.getElementById('xp-next').innerText = playerLvl * 100;
        document.getElementById('lvl-fill').style.width = (playerXP / (playerLvl * 100) * 100) + "%";
        const ts = document.getElementById('display-title');
        if(hasKitsuneTitle) { ts.innerText = "King of Kitsune"; ts.className = "player-title title-kitsune-king"; }
        else { ts.innerText = playerLvl >= 10 ? "Expert" : "Recrue"; ts.className = "player-title " + (playerLvl >= 10 ? "title-expert" : "title-newbie"); }
    }
 
    function selectItem(i) {
        selectedIdx = i; const item = inventory[i];
        if (item.isChest) { if(confirm("Ouvrir ce Sunken Chest ?")) openChest(i); return; }
        document.getElementById('actions').style.display = 'flex';
        document.getElementById('sel-name').innerText = item.name + (item.isFav ? " ‚≠ê" : "");
    }
 
    function toggleFav() { inventory[selectedIdx].isFav = !inventory[selectedIdx].isFav; updateUI(); selectItem(selectedIdx); }
    function sellFruit() { if(inventory[selectedIdx].isFav) return alert("Retire le favori !"); money += (inventory[selectedIdx].price * 0.5 || 1000); inventory.splice(selectedIdx, 1); document.getElementById('actions').style.display = 'none'; updateUI(); }
 
    function openChest(idx) {
        inventory.splice(idx, 1); updateUI();
        const winner = allSkins[Math.floor(Math.random()*allSkins.length)];
        const rail = document.getElementById('gacha-rail');
        rail.style.transition = 'none'; rail.style.transform = 'translateX(0)';
        rail.innerHTML = Array(85).fill().map(() => { const s = allSkins[Math.floor(Math.random()*allSkins.length)]; return `<div class="gacha-item rarity-${s.rarity}"><img src="${s.img}" width="60"><div>${s.name}</div></div>`; }).join('');
        rail.children[70].innerHTML = `<img src="${winner.img}" width="60"><div>${winner.name}</div>`;
        setTimeout(() => { rail.style.transition = 'transform 4.5s cubic-bezier(0.1, 0, 0.1, 1)'; rail.style.transform = `translateX(-${(70 * 180) - (document.querySelector('.gacha-viewport').offsetWidth / 2) + 90}px)`; }, 50);
        setTimeout(() => { inventory.push({...winner}); addXP(50); updateUI(); alert("Nouveau Skin !"); }, 4700);
    }
 
    function startRoll() {
        if(money < 50000) return alert("Besoin de 50k Beli !");
        money -= 50000; updateUI();
        const win = getWin(); const rail = document.getElementById('gacha-rail');
        rail.style.transition = 'none'; rail.style.transform = 'translateX(0)';
        const pool = fruits.filter(f => f.rarity !== "Amber");
        rail.innerHTML = Array(85).fill().map(() => { const f = pool[Math.floor(Math.random()*pool.length)]; return `<div class="gacha-item rarity-${f.rarity}"><img src="${f.img}" width="60"><div>${f.name}</div></div>`; }).join('');
        rail.children[70].innerHTML = `<img src="${win.img}" width="60"><div>${win.name}</div>`;
        setTimeout(() => { rail.style.transition = 'transform 4.5s cubic-bezier(0.1, 0, 0.1, 1)'; rail.style.transform = `translateX(-${(70 * 180) - (document.querySelector('.gacha-viewport').offsetWidth / 2) + 90}px)`; }, 50);
        setTimeout(() => { inventory.push({...win}); addXP(15); updateUI(); }, 4700);
    }
 function removePTradeItem(i) {
    if (lockTrade) return; // Si le cooldown tourne, on ne fait rien
 
    pTradeIndices.splice(i, 1);
    if(document.getElementById('trade-title').innerText === 'TRADE NPC') {
        npcOffer();
    }
    refreshTrade();
}
 
 
    function getWin() { const p = fruits.filter(f => f.rarity !== "Amber"); const t = p.reduce((s,f) => s+f.weight, 0); let r = Math.random()*t; for(let f of p) { if(r < f.weight) return f; r -= f.weight; } }
 
    function openTrade() { pTradeIndices = []; npcTradeItems = []; document.getElementById('trade-title').innerText = "TRADE NPC"; document.getElementById('btn-gen-code').style.display = "block"; document.getElementById('accept-btn').onclick = startTradeTimer; document.getElementById('trade-ui').style.display = 'block'; refreshTrade(); }
    function closeTrade() {
    lockTrade = false; // On s'assure de d√©bloquer si on ferme
    document.getElementById('trade-ui').style.display = 'none';
    document.getElementById('cooldown-timer').style.display = 'none';
    isLocked = false; 
document.getElementById('cooldown-timer').style.display = 'none';
 
    if(tradeInterval) clearInterval(tradeInterval);
    pTradeIndices = [];
    npcTradeItems = [];
}
 
    function openSelector() { 
        document.getElementById('fruit-selector-modal').style.display = 'block'; 
        document.getElementById('selector-grid').innerHTML = inventory.map((f, i) => {
            if(pTradeIndices.includes(i) || f.isFav) return '';
            return `<div class="fruit-card rarity-${f.rarity}" onclick="pTradeIndices.push(${i}); if(document.getElementById('trade-title').innerText==='TRADE NPC')npcOffer(); refreshTrade(); closeSelector();"><img src="${f.img}">${f.name}</div>`;
        }).join(''); 
    }
    function closeSelector() { document.getElementById('fruit-selector-modal').style.display = 'none'; }
    function npcOffer() {
        let pV = pTradeIndices.reduce((s,i) => s + inventory[i].val, 0); npcTradeItems = []; let cur = 0;
        let pool = [...fruits].filter(f => f.rarity !== "Amber").sort((a,b)=>b.val-a.val);
        for(let f of pool) { if(npcTradeItems.length < 4 && (cur+f.val) <= pV * 1.35) { npcTradeItems.push(f); cur += f.val; } }
    }
    function refreshTrade() {
    const ps = document.getElementById('p-slots'); 
    const ns = document.getElementById('npc-slots');
    ps.innerHTML = ''; ns.innerHTML = ''; 
 
    let pV = 0, nV = 0;
 
    // D√©tection ultra-pr√©cise du verrouillage
    const timer = document.getElementById('cooldown-timer');
    const isLocked = (timer && timer.style.display === 'block');
 
    for(let i=0; i<4; i++) {
        // --- TES SLOTS ---
        if(pTradeIndices[i] !== undefined) { 
            let f = inventory[pTradeIndices[i]]; 
            pV += f.val; 
            ps.innerHTML += `
                <div class="fruit-card rarity-${f.rarity}" 
                     style="font-size:10px; cursor:${isLocked ? 'not-allowed' : 'pointer'};" 
                     onclick="removePTradeItem(${i})">
                    <img src="${f.img}" width="40"><br>${f.name}
                </div>`; 
        } else {
            ps.innerHTML += `
                <div style="border:2px dashed #444; display:flex; align-items:center; justify-content:center; cursor:${isLocked ? 'not-allowed' : 'pointer'};" 
                     onclick="if(!${isLocked}) openSelector()">+</div>`;
        }
 
        // --- SLOTS NPC ---
        if(npcTradeItems[i]) { 
            nV += npcTradeItems[i].val; 
            ns.innerHTML += `<div class="fruit-card rarity-${npcTradeItems[i].rarity}" style="font-size:10px;"><img src="${npcTradeItems[i].img}" width="40"><br>${npcTradeItems[i].name}</div>`; 
        } else {
            ns.innerHTML += `<div style="border:2px dashed #333;"></div>`;
        }
    }
 
    document.getElementById('p-val').innerText = pV.toLocaleString(); 
    document.getElementById('n-val').innerText = nV.toLocaleString();
 
    const btn = document.getElementById('accept-btn'); 
    const msg = document.getElementById('diff-msg');
 
    if(pV > 0 && (Math.abs(pV - nV) / Math.max(pV, nV) <= 0.4)) { 
        btn.disabled = isLocked; 
        msg.innerText = "√âQUITABLE ‚úì"; 
        msg.style.color = "#2ecc71"; 
    } else { 
        btn.disabled = true; 
        msg.innerText = "VALEUR IN√âGALE ‚ö†"; 
        msg.style.color = "#ff4757"; 
    }
}
 const availableTitles = [
    { name: "Recrue", class: "title-newbie", requirement: () => true },
    { name: "Expert", class: "title-expert", requirement: () => playerLvl >= 10 },
    { name: "King of Kitsune", class: "title-kitsune-king", requirement: () => hasKitsuneTitle },
    { name: "Dough King", class: "title-dough-king", requirement: () => hasDoughTitle }
];

function openTitleMenu() {
    const list = document.getElementById('title-list');
    list.innerHTML = "";
    
    availableTitles.forEach(t => {
        if (t.requirement()) {
            const btn = document.createElement('button');
            btn.className = `player-title ${t.class}`;
            btn.style.cssText = "padding: 10px; cursor: pointer; text-align: center; background: #222; border: 1px solid #444; margin-bottom: 5px;";
            btn.innerText = t.name;
            btn.onclick = () => {
                applyTitle(t.name, t.class);
                document.getElementById('title-menu').style.display = 'none';
            };
            list.appendChild(btn);
        }
    });
    document.getElementById('title-menu').style.display = 'block';
}

function applyTitle(name, className) {
    const display = document.getElementById('display-title');
    display.innerText = name;
    display.className = `player-title ${className}`;
    save(); // Sauvegarde le choix
}
function addXP(amount) {
    playerXP += amount;
    let xpNeeded = playerLvl * 100; // Chaque niveau demande 100 XP de plus

    // V√©rifie si le joueur monte de niveau
    while (playerXP >= xpNeeded) {
        playerXP -= xpNeeded;
        playerLvl++;
        xpNeeded = playerLvl * 100;
        alert("üéâ LEVEL UP ! Vous √™tes maintenant Niveau " + playerLvl);
    }
    
    updateProfileUI(); // Met √† jour l'affichage
    save(); // Sauvegarde les progr√®s
}
function updateProfileUI() {
    const xpNeeded = playerLvl * 100;
    const progressPercent = (playerXP / xpNeeded) * 100;

    // Mise √† jour des textes
    document.getElementById('player-lvl').innerText = playerLvl;
    document.getElementById('player-xp').innerText = playerXP;
    document.getElementById('xp-next').innerText = xpNeeded;

    // Mise √† jour visuelle de la barre
    const fill = document.getElementById('lvl-fill');
    if (fill) {
        fill.style.width = progressPercent + "%";
    }
}

 
// AJOUTE AUSSI CETTE FONCTION POUR QUE LE CLIC SUR LES FRUITS FONCTIONNE
function removePTradeItem(i) {
    if (isLocked) return; // Bloqu√© si le timer tourne
    pTradeIndices.splice(i, 1);
    if(document.getElementById('trade-title').innerText === 'TRADE NPC') npcOffer();
    refreshTrade();
}
 
 
 
 
    function exportCode() {
    const d = { 
        type: "INIT", 
        f: pTradeIndices.map(i => inventory[i].name), 
        v: pTradeIndices.reduce((s,i)=>s+inventory[i].val,0), 
        n: document.getElementById('player-name').value, 
        t: document.getElementById('display-title').innerText // ON AJOUTE LE TITRE ICI
    };
    prompt("CODE POUR JOUEUR B :", btoa(JSON.stringify(d))); 
    closeTrade(); 
}
    function importCode() {
    const c = prompt("Colle le code :"); if(!c) return;
    try {
        const d = JSON.parse(atob(c));
        if(d.type === "INIT") {
            // ... (chargement des fruits habituel)
            npcTradeItems = d.f.map(n => [...fruits, sunkenChest].find(x => x && x.name === n)).filter(x=>x);
            pTradeIndices = []; 
            
            // MISE √Ä JOUR DE L'AFFICHAGE : Pseudo + Titre
            const titleHTML = `<span class="player-title" style="font-size:12px; margin-left:10px;">${d.t}</span>`;
            document.getElementById('trade-title').innerHTML = `TRADE : ${d.n} ${titleHTML}`;
            
            document.getElementById('btn-gen-code').style.display = "none";
            // ... (reste de la logique accept-btn)
            document.getElementById('trade-ui').style.display = 'block'; 
            refreshTrade();
        } 
        // ... (logique FINAL)
    } catch(e) { alert("Code erron√©"); }
}

 
    function activateDLC() {
    const input = document.getElementById('dlc-input');
    const v = input.value.toUpperCase().trim();
    
    // --- üéÆ NOUVEAU : DASH CENTER (SGC1220) ---
    // Dans ta fonction activateDLC()
if(v === "SGC1220") {
    isLocked = false; // ON FORCE LE D√âVERROUILLAGE DES BOUTONS
    document.getElementById('games-panel').style.left = "0px";
    alert("üïπÔ∏è DASH CENTER OUVERT !");
}


    // --- üõ†Ô∏è ADMIN PANEL : GIVER DE FRUITS (DPAPC1220) ---
    else if(v === "DPAPC1220") {
        document.getElementById('admin-panel').style.left = "0px";
        const list = document.getElementById('admin-fruit-list');
        list.innerHTML = ""; // Nettoyage de la liste
        
        fruits.forEach(f => {
            const row = document.createElement('div');
            row.className = `fruit-card rarity-${f.rarity}`;
            row.style.cssText = "margin: 2px 0; padding: 8px; display: flex; align-items: center; gap: 10px; cursor: pointer; border: 1px solid #333;";
            row.innerHTML = `<img src="${f.img}" width="25"> <span style="font-size: 0.9em;">${f.name}</span>`;
            
            row.onclick = () => {
                inventory.push({...f, isFav: false}); 
                updateUI();
            };
            list.appendChild(row);
        });
        alert("üõ†Ô∏è PANEL ADMIN OUVERT");
    }

    // --- üç© TITRE MYTHIQUE : DOUGH KING RGB (DKSC1220) ---
    else if(v === "DKSC1220") {
        hasDoughTitle = true;
        alert("üç© TITRE D√âBLOQU√â : Dough King (Effet arc-en-ciel activ√©) !");
    }

    // --- ‚öîÔ∏è OBJET UNIQUE : TRIPLE DARK BLADE (TDBC1220) ---
    else if(v === "TDBC1220") {
        inventory.push({ 
            name: "Dark Blade", rarity: "Amber", 
            price: 150000000, val: 150000000, 
            isFav: true, isSpecial: true,
            img: "https://api.dicebear.com" 
        });
        alert("‚öîÔ∏è GAMEPASS : Triple Dark Blade ajout√©e √† l'inventaire !");
    }
    
    // --- ü¶ä TITRE : KING OF KITSUNE (KOFKC1220) ---
    else if(v === "KOFKC1220") { 
        hasKitsuneTitle = true; 
        alert("ü¶ä TITRE D√âBLOQU√â : King of Kitsune !"); 
    }
    
    // --- üì¶ OBJET : SUNKEN CHEST (SCC1220) ---
    else if(v === "SCC1220") { 
        inventory.push({ 
            name: "Sunken Chest", rarity: "Legendary", 
            isChest: true, val: 40000000, 
            img: "https://api.dicebear.com" 
        }); 
        alert("üì¶ OBJET RE√áU : Sunken Chest (Impossible √† vendre) !"); 
    }
    
    // --- üî• FRUIT : DRAGON AMBER (AWDBFC1220) ---
    else if(v === "AWDBFC1220") { 
        const dragA = fruits.find(f => f.name === "Dragon Amber");
        if(dragA) {
            inventory.push({...dragA, isFav: true});
            alert("üî• FRUIT MYTHIQUE : Dragon Amber re√ßu !");
        }
    }
    
    else { 
        alert("‚ùå Code invalide ou d√©j√† utilis√©."); 
    }

    input.value = ""; 
    updateUI(); 
    save(); // Sauvegarde automatique sur le navigateur
}

let gameRunning = false;
let animationID;

function startGeoDash() {
    // ON CACHE LE PANNEAU DE S√âLECTION
    document.getElementById('games-panel').style.left = "-300px";
    
    document.getElementById('dash-modal').style.display = 'block';
    gameRunning = true;
    const modal = document.getElementById('dash-modal');
    const canvas = document.getElementById('gd');
    const ctx = canvas.getContext('2d');
    const pctEl = document.getElementById('pct');
    
    modal.style.display = 'block';
    gameRunning = true;

    // --- CONFIGURATION ---
    const SPEED = 2.8; const GRAVITY = 0.24; const JUMP = -7.5; const TILE = 50;
    const GROUND_Y = 350; const CEILING_Y = 50; const PAD_POWER = 10.5;
    const MAP_DATA = ("00000000000000000000000200000200000200000011100022000111002200092220000111100009222000000070000000000000000333333333444000330033344400033333333444003333330003333440000000000080000000000000000922200001111000092221110011001100110011000009222000092220000922200000000000000000000").split('');

    let player = { x: 160, y: 310, w: 40, h: 40, dy: 0, angle: 0, onGround: false, gravDir: 1, trail: [] };
    let scrollX = 0; let isInput = false;

    // --- CONTR√îLES ---
    window.onkeydown = (e) => { if(e.code === 'Space') isInput = true; };
    window.onkeyup = () => isInput = false;
    canvas.onmousedown = () => isInput = true;
    canvas.onmouseup = () => isInput = false;

    function reset() {
        let currentPct = parseInt(pctEl.innerText);
        if(currentPct > 0) {
            money += currentPct * 750;
            if(typeof addXP === 'function') addXP(currentPct * 5);
            updateUI();
        }
        scrollX = 0; player.y = 310; player.dy = 0; player.angle = 0; player.gravDir = 1; player.trail = [];
    }

    function loop() {
        if(!gameRunning) return;

        // 1. UPDATE
        player.dy += GRAVITY * player.gravDir;
        player.y += player.dy;
        player.onGround = false;
        player.trail.push({ x: player.x, y: player.y, angle: player.angle });
        if (player.trail.length > 12) player.trail.shift();

        if (player.y + player.h > GROUND_Y) { player.y = GROUND_Y - player.h; player.dy = 0; player.onGround = (player.gravDir === 1); }
        if (player.y < CEILING_Y) { player.y = CEILING_Y; player.dy = 0; player.onGround = (player.gravDir === -1); }

        let gridX = Math.floor((scrollX + player.x + 20) / TILE);
        let type = MAP_DATA[gridX];
        let margin = 12; let pHitY = player.y + margin; let pHitSize = player.w - (margin * 2);

        // COLLISIONS (Logique fid√®le √† ton code)
        if (type === '1') {
            let bTop = GROUND_Y - TILE;
            if (player.dy >= 0 && (player.y + player.h) >= bTop && (player.y + player.h) <= bTop + 15) { player.y = bTop - player.h; player.dy = 0; player.onGround = true; } 
            else if (pHitY + pHitSize > bTop + 5) reset();
        } else if (type === '3') {
            let bBot = CEILING_Y + TILE;
            if (player.dy <= 0 && player.y <= bBot && player.y >= bBot - 15) { player.y = bBot; player.dy = 0; player.onGround = true; } 
            else if (pHitY < bBot - 5) reset();
        } else if (type === '2' && pHitY + pHitSize > GROUND_Y - 25) reset();
        else if (type === '4' && pHitY < CEILING_Y + 25) reset();
        else if (type === '7' && player.gravDir === 1) { player.gravDir = -1; player.dy = 0; }
        else if (type === '8' && player.gravDir === -1) { player.gravDir = 1; player.dy = 0; }
        else if (type === '9' && player.onGround && player.gravDir === 1) { player.dy = -PAD_POWER; player.onGround = false; }
        else if (type === '10' && player.onGround && player.gravDir === -1) { player.dy = PAD_POWER; player.onGround = false; }

        if (isInput && player.onGround) { player.dy = -7.5 * player.gravDir; player.onGround = false; }
        if (!player.onGround) player.angle += 0.1 * player.gravDir;
        else player.angle = Math.round(player.angle / (Math.PI/2)) * (Math.PI/2);

        scrollX += SPEED;
        pctEl.innerText = Math.min(100, Math.floor((scrollX / (MAP_DATA.length * TILE)) * 100));

        // 2. DESSIN (Ce qui √©vite l'√©cran noir)
        let grd = ctx.createLinearGradient(0, 0, 0, 450);
        grd.addColorStop(0, "#0066ff"); grd.addColorStop(1, "#001133");
        ctx.fillStyle = grd; ctx.fillRect(0, 0, 800, 450);

        // Map
        MAP_DATA.forEach((t, i) => {
            let x = i * TILE - scrollX;
            if (x < -TILE || x > 800) return;
            if (t === '1') { ctx.fillStyle = "#000"; ctx.fillRect(x, GROUND_Y-TILE, TILE, TILE); ctx.strokeStyle = "#fff"; ctx.strokeRect(x, GROUND_Y-TILE, TILE, TILE); }
            if (t === '3') { ctx.fillStyle = "#000"; ctx.fillRect(x, CEILING_Y, TILE, TILE); ctx.strokeStyle = "#fff"; ctx.strokeRect(x, CEILING_Y, TILE, TILE); }
            if (t === '2') { ctx.fillStyle = "#000"; ctx.beginPath(); ctx.moveTo(x, GROUND_Y); ctx.lineTo(x+TILE, GROUND_Y); ctx.lineTo(x+TILE/2, GROUND_Y-45); ctx.fill(); ctx.stroke(); }
            if (t === '4') { ctx.fillStyle = "#000"; ctx.beginPath(); ctx.moveTo(x, CEILING_Y); ctx.lineTo(x+TILE, CEILING_Y); ctx.lineTo(x+TILE/2, CEILING_Y+45); ctx.fill(); ctx.stroke(); }
            if (t === '7') { ctx.fillStyle = "rgba(255, 255, 0, 0.3)"; ctx.fillRect(x+20, 50, 10, 300); }
            if (t === '8') { ctx.fillStyle = "rgba(0, 136, 255, 0.3)"; ctx.fillRect(x+20, 50, 10, 300); }
            if (t === '9' || t === '10') { ctx.fillStyle = "yellow"; ctx.beginPath(); ctx.ellipse(x+25, (t==='9'?345:55), 20, 5, 0, 0, 7); ctx.fill(); }
        });

        // Sols et Joueur
        ctx.fillStyle = "#000822"; ctx.fillRect(0, GROUND_Y, 800, 100); ctx.fillRect(0, 0, 800, CEILING_Y);
        ctx.save(); ctx.translate(player.x + 20, player.y + 20); ctx.rotate(player.angle);
        ctx.fillStyle = "#00fbff"; ctx.fillRect(-20, -20, 40, 40);
        ctx.strokeStyle = "#fff"; ctx.strokeRect(-15, -15, 30, 30); ctx.restore();

        animationID = requestAnimationFrame(loop);
    }
    loop();
}

function stopGeoDash() {
    gameRunning = false;
    cancelAnimationFrame(animationID);
    document.getElementById('dash-modal').style.display = 'none';
    
    // ON R√âAFFICHE LE PANNEAU DE S√âLECTION
    document.getElementById('games-panel').style.left = "0px";
    updateUI();
}


function loop() {
    if (!gameRunning) return; // SI gameRunning est faux, on arr√™te TOUT ici.
    
    // ... reste de ton code (update, draw, etc.)
    
    animationID = requestAnimationFrame(loop);
    // √Ä mettre juste apr√®s scrollX += SPEED;
let progress = Math.min(100, Math.floor((scrollX / (MAP_DATA.length * TILE)) * 100));
document.getElementById('pct').innerText = progress;

}
let snakeInterval;
function startSnakeGame() {
    document.getElementById('snake-modal').style.display = 'block';
    const canvas = document.getElementById("snakeCanvas");
    const ctx = canvas.getContext("2d");
    const box = 20;
    
    let snakeScore = 0;
    let snake = [{ x: 10 * box, y: 10 * box }, { x: 9 * box, y: 10 * box }];
    let food = { x: Math.floor(Math.random() * 19 + 1) * box, y: Math.floor(Math.random() * 19 + 1) * box };
    let d = "RIGHT";

    // Contr√¥les (Z,Q,S,D et Fl√®ches)
    window.onkeydown = (e) => {
        if([32,37,38,39,40].includes(e.keyCode)) e.preventDefault();
        if((e.keyCode == 37 || e.key == 'q') && d != "RIGHT") d = "LEFT";
        else if((e.keyCode == 38 || e.key == 'z') && d != "DOWN") d = "UP";
        else if((e.keyCode == 39 || e.key == 'd') && d != "LEFT") d = "RIGHT";
        else if((e.keyCode == 40 || e.key == 's') && d != "UP") d = "DOWN";
    };

    if(snakeInterval) clearInterval(snakeInterval);
    snakeInterval = setInterval(() => {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // Pomme
        ctx.fillStyle = "#E74C3C"; ctx.beginPath();
        ctx.arc(food.x + box/2, food.y + box/2, box/2.2, 0, Math.PI*2); ctx.fill();

        // Serpent
        snake.forEach((part, i) => {
            ctx.fillStyle = (i === 0) ? "#4674E9" : "#527DF2";
            ctx.beginPath();
            ctx.roundRect(part.x + 1, part.y + 1, box - 2, box - 2, (i === 0) ? 8 : 4);
            ctx.fill();
        });

        let snakeX = snake[0].x; let snakeY = snake[0].y;
        if(d == "LEFT") snakeX -= box; if(d == "UP") snakeY -= box;
        if(d == "RIGHT") snakeX += box; if(d == "DOWN") snakeY += box;

        if(snakeX == food.x && snakeY == food.y) {
            snakeScore++;
            document.getElementById("snake-score").innerText = snakeScore;
            food = { x: Math.floor(Math.random() * 19 + 1) * box, y: Math.floor(Math.random() * 19 + 1) * box };
        } else { snake.pop(); }

        let newHead = { x: snakeX, y: snakeY };

        // Game Over
        if(snakeX < 0 || snakeX >= canvas.width || snakeY < 0 || snakeY >= canvas.height || snake.some(p => p.x === newHead.x && p.y === newHead.y)) {
            let gain = snakeScore * 500;
            money += gain;
            if(typeof addXP === 'function') addXP(snakeScore * 10);
            updateUI();
            alert("üêç Snake Over ! Gain : " + gain + " Beli");
            stopSnake();
        }
        snake.unshift(newHead);
    }, 100);
}

function stopSnake() {
    clearInterval(snakeInterval);
    document.getElementById('snake-modal').style.display = 'none';
    window.onkeydown = null;
}







 
    function startTradeTimer() {
    if (isLocked) return; // S√©curit√© si d√©j√† lanc√©
 
    isLocked = true; // ON VERROUILLE TOUT
    const btn = document.getElementById('accept-btn');
    const timerDisplay = document.getElementById('cooldown-timer');
 
    btn.disabled = true;
    btn.style.opacity = "0.5";
    timerDisplay.style.display = 'block';
 
    refreshTrade(); // On rafra√Æchit pour appliquer le verrou visuel
 
    let c = 10;
    timerDisplay.innerText = c;
 
    if (tradeInterval) clearInterval(tradeInterval);
    tradeInterval = setInterval(() => {
        c--;
        timerDisplay.innerText = c;
        if (c <= 0) {
            clearInterval(tradeInterval);
 
            // Transfert des fruits
            pTradeIndices.sort((a,b)=>b-a).forEach(i=>inventory.splice(i,1));
            npcTradeItems.forEach(f=>inventory.push({...f}));
 
            isLocked = false; // ON D√âVERROUILLE
            timerDisplay.style.display = 'none';
            closeTrade();
            updateUI();
            alert("Trade r√©ussi !");
        }
    }, 1000);
}
 function openAdminPanel() {
    const panel = document.getElementById('admin-panel');
    const list = document.getElementById('admin-fruit-list');
    
    panel.style.left = "0px"; // Fait glisser le panneau vers la droite
    list.innerHTML = ""; // Vide la liste
    
    // On boucle sur tous les fruits existants dans ton code
    fruits.forEach(f => {
        const btn = document.createElement('div');
        btn.className = `fruit-card rarity-${f.rarity}`;
        btn.style.margin = "5px 0";
        btn.style.padding = "5px";
        btn.style.cursor = "pointer";
        btn.innerHTML = `<img src="${f.img}" width="30"> ${f.name}`;
        
        btn.onclick = () => {
            inventory.push({...f, isFav: false}); // Ajoute le fruit √† l'inventaire
            updateUI(); // Rafra√Æchit l'inventaire visuellement
        };
        list.appendChild(btn);
    });
}

 
 
 
 
    load(); updateUI();
function sellAllNonFav() {
    let totalGain = 0;
    let initialCount = inventory.length;

    for (let i = inventory.length - 1; i >= 0; i--) {
        // On ne vend QUE si : pas de favori ET pas un coffre
        if (!inventory[i].isFav && !inventory[i].isChest) {
            let fruitPrice = inventory[i].price || 1000;
            totalGain += (fruitPrice * 0.5);
            inventory.splice(i, 1);
        }
    }

    let soldCount = initialCount - inventory.length;
    if (soldCount > 0) {
        money += totalGain;
        document.getElementById('actions').style.display = 'none'; 
        updateUI(); 
        alert("Vendu " + soldCount + " fruits pour " + totalGain.toLocaleString() + "$ ! (Tes coffres ont √©t√© √©pargn√©s)");
    } else {
        alert("Rien √† vendre (tout est prot√©g√© ‚≠ê ou ce sont des coffres üì¶)");
    }
}

</script>
 

</body></html>
